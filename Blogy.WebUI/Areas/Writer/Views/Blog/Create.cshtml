@using Microsoft.AspNetCore.Mvc.Rendering
@using Blogy.Business.DTOs.BlogDtos
@model CreateBlogDto

@{
    ViewData["Title"] = "Yeni Blog Yaz";
    Layout = "~/Views/UILayout/Index.cshtml";
}

<div class="container mt-4 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">

            <div class="card shadow-sm p-4">

                <h3 class="fw-bold mb-3">Yeni Blog Yaz</h3>
                <p class="text-muted">Aşağıdaki alanları doldurarak yeni bir blog yazabilirsin.</p>

                <div class="card bg-light p-3 mb-4 border-0 shadow-sm">
                    <h5>AI ile Blog İçeriği Oluştur</h5>

                    <label class="mt-2">Anahtar Kelimeler</label>
                    <input id="aiKeywords" class="form-control" placeholder="Örn: yazılım, teknoloji" />

                    <label class="mt-3">Açıklama (Prompt)</label>
                    <textarea id="aiPrompt" class="form-control" rows="3"></textarea>

                    <button id="btnGenerateAi" class="btn btn-warning mt-3">AI ile İçerik Üret</button>

                    <div id="aiLoader" class="mt-2 text-muted" style="display:none;">AI üretiyor...</div>
                </div>

<form method="post">

    <label>Başlık</label>
    <input asp-for="Title" id="Title" class="form-control" />
    <span class="text-danger" asp-validation-for="Title"></span>

    <label class="mt-3">Açıklama</label>
    <textarea asp-for="Description" id="DescriptionArea" class="form-control" rows="6"></textarea>
    <span class="text-danger" asp-validation-for="Description"></span>

    <label class="mt-3">Kapak Görseli</label>
    <input asp-for="CoverImage" class="form-control" />
    <span class="text-danger" asp-validation-for="CoverImage"></span>

    <label class="mt-3">Blog Görseli 1</label>
    <input asp-for="BlogImage1" class="form-control" />

    <label class="mt-3">Blog Görseli 2</label>
    <input asp-for="BlogImage2" class="form-control" />

    <!-- KATEGORİ DROPDOWN -->
                    <label>Kategori</label>
                    <select asp-for="CategoryId" class="form-control" asp-items="Model.Categories">
                        <option value="">Kategori Seçiniz</option>
                    </select>
                    <span class="text-danger" asp-validation-for="CategoryId"></span>
                   
    <button class="btn btn-primary mt-4">Kaydet</button>

</form>

            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $("#btnGenerateAi").click(function () {

            let keywords = $("#aiKeywords").val();
            let prompt = $("#aiPrompt").val();

            if (!keywords) return alert("Lütfen anahtar kelime girin!");

            $("#btnGenerateAi").prop("disabled", true).text("AI üretiyor...");
            $("#aiLoader").show();

            $.ajax({
                url: "/Writer/Blog/GenerateBlogWithAi",
                type: "POST",
                data: { keywords, prompt },

                success: function (data) {

                    if (data.error) {
                        alert("AI HATASI: " + data.error);
                        return;
                    }

                    // SADE HAL: sadece başlık ve açıklama
                    $("#Title").val(data.title);
                    $("#DescriptionArea").val(data.description);

                    $("#btnGenerateAi").prop("disabled", false).text("AI ile İçerik Üret");
                    $("#aiLoader").hide();
                },

                error: function () {
                    alert("AI içerik oluşturulamadı!");
                    $("#btnGenerateAi").prop("disabled", false).text("AI ile İçerik Üret");
                    $("#aiLoader").hide();
                }
            });

        });
    </script>
}

